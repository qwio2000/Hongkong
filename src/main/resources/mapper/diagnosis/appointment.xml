<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeiglobal.hk.repository.diagnosis.AppointmentRepository">
	<!--  무료진단 예약 조회 -->
	<select id="findAppointmentSerch" statementType="CALLABLE" parameterType="HASHMAP" resultType="com.jeiglobal.hk.domain.diagnosis.AppointmentDto$AppointmentSerch">
		CALL globalbiz.SPMemberSearchList(#{jisaCD},#{deptCD},'','','','','3',#{name},#{name},'','','','','','','','',#{pageNum},#{pageSize})
	</select>
	
	<!--  무료진단 신규 조회 -->
	<select id="findAppointmentSerchJson" statementType="CALLABLE" parameterType="HASHMAP" resultType="com.jeiglobal.hk.domain.diagnosis.AppointmentDto$AppointmentSerchJson">
		SELECT 
			CONCAT(a.mFstName, ' ' ,a.mLstName) AS student
		,	CONCAT(a.gFstName, ' ' ,a.gLstName) AS guardianName		
		,	CONCAT(a.zip, ' ' ,a.addr) AS addr	
		,	a.city
		,	a.gPhone
		, 	IFNULL(b.statusCD,'') AS statusCD
		,	FuncCodeDtlNM(a.jisaCD,'0008',b.statusCD,'','') AS statusName	
		,	a.memKey as memKey
		FROM globalbiz.MemAppointment AS a
		LEFT JOIN (
			SELECT memKey,'1' AS statusCD
			FROM globalbiz.MemSubjMst 
			WHERE statusCD='1' AND jisaCD=#{jisaCD} AND deptCD=#{deptCD}
			GROUP BY memKey
		)AS b
		ON a.memKey = b.memKey
		WHERE a.jisaCD=#{jisaCD} AND a.deptCD=#{deptCD}
		AND (a.mFstName LIKE CONCAT('%', #{name}, '%') OR a.mLstName LIKE CONCAT('%', #{name}, '%'))

	</select>
	
	

</mapper>